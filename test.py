import sys
import numpy as np
sys.path.append("../")
from burger_lib.guezzi import *

t_sotto = [0, 10, 20, 30, 40, 50, 60, 70, 80, 90, 100, 110, 120, 130, 140, 160, 180, 200, 220, 240, 260, 280, 300, 320,340, 360, 380, 400, 420, 440, 460, 480, 500, 520, 540, 560, 580, 600, 620, 640, 660, 680, 700, 720, 740, 760, 780, 800, 820, 840, 860, 880, 900, 920, 940, 960, 980, 1000, 1020, 1040, 1060, 1080, 1100, 1120, 1140, 1160, 1180, 1200, 1220, 1240, 1260, 1280, 1300, 1320, 1340, 1360, 1380, 1400, 1420, 1440, 1460, 1480, 1500, 1520, 1540, 1560, 1580, 1600, 1620, 1640, 1660, 1680, 1700, 1720, 1740, 1760, 1780, 1800, 1820, 1840, 1860, 1880, 1900, 1920, 1940, 1960, 1980, 2000] # micro s (10^(-6))
t_sotto = Measurement(t_sotto, 1, magnitude=-6, unit='s', name='Tempo')                                                                                                                                                                                                    #aggiunta dopo
tensione_sotto = [2.8, 12.0, 20.8, 29.2, 36.8, 44.0, 50.4, 55.6, 60.0, 64.0, 67.2, 69.6, 71.2, 71.6, 71.2, 68.0, 61.0, 53.2, 42.4, 30.4, 17.6, 4.8, -8.0, -19.6, -29.6, -37.6, -44.0, -47.2, -48.0, -47.2, -44.0, -39.2, -32.0,    -24.0,     -16.0, -6.4, 2.4, 10.4, 17.2, 24.0, 29.2, 32.8, 34.0, 33.6, 32.8, 29.6, 25.6, 20.0, 14.4, 8.0, 1.6, -4.0, -9.6, -14.4, -18.4, -20.8, -22.4, -23.2, -22.4, -20.8, -18.4, -14.8, -10.8, -6.4, -2.0, 2.0, 6.0, 9.6, 12.0, 14.4, 16.0, 16.8, 16.9, 15.2, 13.6, 11.6, 8.8, 6.4, 3.2, 0.0, -2.4, -5.2, -7.2, -8.8, -10.4, -10.8, -10.8, -10.4, -9.2, -8.0, -6.4, -4.0, -2.0, 0.0, 2.0, 4.0, 5.2, 6.4, 7.2, 8.0, 8.0, 8.0, 7.2, 6.4, 5.2, 4.0, 2.4, 0.8] #milli V
err_tensione_sotto = [0.4, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.1, 0.4, 0.1, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.4, 0.1, 0.4, 0.4, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.1, 0.4, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.1, 0.4, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.1, 0.4, 0.1, 0.1, 0.1] #milli V
tensione_sotto = Measurement(tensione_sotto, err_tensione_sotto, magnitude=-3, unit='V', name='Tensione')

def tensiore_sotto_(t, V_0, gamma, omega):
    return V_0 * np.exp(-gamma * t) * np.sin(t * np.sqrt((omega**2) - (gamma**2)))
fit = perform_fit(t_sotto, tensione_sotto, func=tensiore_sotto_, p0=[100, 600, 3000], parameter_names=['V_0', 'gamma', 'omega'], method='minuit')
plot_fit(fit, plot_residuals=True, n_fit_points=10000, title='Circuito RLC - Regime Sottosmorzato', show_plot=True, show_params=True, show_stats=True)